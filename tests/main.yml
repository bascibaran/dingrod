---
- name: Bring up cent6 docker container
  hosts: localhost
  gather_facts: false
  vars:
    inventory:
      - name: dinghost
        image: "chrismeyers/centos6"
  roles:
    - { role: provision_docker, provision_docker_inventory: "{{inventory}}" }
    
- name: test dingrod!
  hosts: docker_containers
  roles:
    - { role: dingrod, dingrod_irods_host: data.iplantcollaborative.org, dingrod_irods_zone: iplant} 
  tasks:
    - name: Verify dingrod exists
      stat:
        path: /etc/init.d/dingrod
      register: response
      failed_when: not response.stat.exists

    - name: Test template expansion dingrod
      shell: cat /etc/init.d/dingrod | grep '^DAEMON_ARGS' > dingarg ; export $(cat dingarg)
    - name: test expansion dingrod part 2
      command: echo $DAEMON_ARGS
      register: dingport
    - name: assert correct expansion
      assert:
        that:
          - "dingport.stdout == 8080"

    - name: Verify irods_environment.json exists
      stat:
        path: /var/lib/dingrod/.irods/irods_environment.json
      register: response
      failed_when: not response.stat.exists  
    - name: Test template expansion irods_environment.json
      command: echo BLOORG
    - name: start dingrod
      command: sudo service dingrod start 
